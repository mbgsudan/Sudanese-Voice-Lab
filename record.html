<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ - ØµÙˆØªÙ†Ø§</title>
<style>
body {
  font-family: 'Cairo', sans-serif;
  background: linear-gradient(160deg, #0b0b0b, #111);
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 40px 15px;
}
.container {
  max-width: 450px;
  margin: auto;
  background: #1a1a1a;
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 0 25px rgba(0,255,200,0.15);
}
h1 {
  color: #00e0b6;
  margin-bottom: 20px;
}
button {
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
  margin: 10px 5px;
  transition: 0.3s;
}
#startBtn {
  background: linear-gradient(90deg,#00e0b6,#00b4d8);
  color: #fff;
}
#stopBtn {
  background: #ff4d4d;
  color: #fff;
}
button:hover {
  transform: scale(1.05);
}
audio {
  margin-top: 15px;
  width: 100%;
}
#volumeBar {
  width: 100%;
  height: 10px;
  background: #222;
  border-radius: 5px;
  margin: 10px 0;
  overflow: hidden;
}
#volumeLevel {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg,#00e0b6,#00b4d8);
  transition: width 0.1s ease;
}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª - ØµÙˆØªÙ†Ø§</h1>
  <p>Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„" ÙˆØªØ­Ø¯Ø« Ø¨ÙˆØ¶ÙˆØ­ Ù‚Ø±Ø¨ Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†.</p>

  <div id="volumeBar"><div id="volumeLevel"></div></div>
  <p id="volumeStatus" style="font-size:14px;color:#ccc;">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª: Ø¬Ø§Ù‡Ø²</p>

  <button id="startBtn">â–¶ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
  <button id="stopBtn" disabled>â¹ï¸ Ø£ÙˆÙ‚Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>

  <audio id="audioPlayer" controls style="display:none;"></audio>
</div>

<script>
let mediaRecorder;
let audioChunks = [];
let audioContext, analyser, gainNode, source;
let animationFrame;

async function startRecording() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      audio: {
        noiseSuppression: true,
        echoCancellation: true,
        autoGainControl: true
      }
    });

    audioContext = new AudioContext();
    source = audioContext.createMediaStreamSource(stream);

    gainNode = audioContext.createGain();
    gainNode.gain.value = 2.2; // ØªØ¶Ø®ÙŠÙ… Ø§Ù„ØµÙˆØª

    analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;

    source.connect(gainNode);
    gainNode.connect(analyser);
    const destination = audioContext.createMediaStreamDestination();
    gainNode.connect(destination);

    mediaRecorder = new MediaRecorder(destination.stream);
    audioChunks = [];

    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = saveRecording;

    mediaRecorder.start();
    visualizeVolume();
    document.getElementById("startBtn").disabled = true;
    document.getElementById("stopBtn").disabled = false;
    document.getElementById("volumeStatus").textContent = "ğŸ™ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...";
  } catch (err) {
    alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†.");
    console.error(err);
  }
}

function stopRecording() {
  if (mediaRecorder && mediaRecorder.state !== "inactive") {
    mediaRecorder.stop();
    cancelAnimationFrame(animationFrame);
    document.getElementById("startBtn").disabled = false;
    document.getElementById("stopBtn").disabled = true;
    document.getElementById("volumeStatus").textContent = "â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„.";
  }
}

function saveRecording() {
  const blob = new Blob(audioChunks, { type: "audio/webm" });
  const url = URL.createObjectURL(blob);
  const player = document.getElementById("audioPlayer");
  player.src = url;
  player.style.display = "block";

  // ğŸ”Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
  const reader = new FileReader();
  reader.onload = function() {
    const arrayBuffer = reader.result;
    audioContext.decodeAudioData(arrayBuffer, (decoded) => {
      const rms = Math.sqrt(decoded.getChannelData(0).reduce((sum, x) => sum + x*x, 0) / decoded.length);
      if (rms < 0.01)
        alert("ğŸ”ˆ Ø§Ù„ØµÙˆØª Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ù‹Ø§ØŒ Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø§ÙŠÙƒ.");
      else if (rms > 0.2)
        alert("ğŸ“¢ Ø§Ù„ØµÙˆØª Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ù‹Ø§ØŒ Ø§Ø¨ØªØ¹Ø¯ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù…Ø§ÙŠÙƒ.");
      else
        alert("âœ… Ø§Ù„ØµÙˆØª Ø¬ÙŠØ¯ Ù„Ù„ØªØ¯Ø±ÙŠØ¨!");
    });
  };
  reader.readAsArrayBuffer(blob);
}

function visualizeVolume() {
  const dataArray = new Uint8Array(analyser.frequencyBinCount);
  function draw() {
    analyser.getByteFrequencyData(dataArray);
    const avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;
    const volume = Math.min(100, (avg / 128) * 100);
    document.getElementById("volumeLevel").style.width = volume + "%";

    const status = document.getElementById("volumeStatus");
    if (volume < 20) status.textContent = "ğŸ”ˆ Ø§Ù„ØµÙˆØª Ù…Ù†Ø®ÙØ¶";
    else if (volume > 80) status.textContent = "ğŸ“¢ Ø§Ù„ØµÙˆØª Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ù‹Ø§";
    else status.textContent = "ğŸ¤ Ø§Ù„ØµÙˆØª Ø¬ÙŠØ¯";

    animationFrame = requestAnimationFrame(draw);
  }
  draw();
}

document.getElementById("startBtn").addEventListener("click", startRecording);
document.getElementById("stopBtn").addEventListener("click", stopRecording);
</script>
</body>
</html>
