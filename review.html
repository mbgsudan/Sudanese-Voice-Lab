<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ› ï¸ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª - ØµÙˆØªÙ†Ø§</title>
<style>
body{font-family:Cairo,Arial,sans-serif;background:#0b0b0b;color:#fff;text-align:center;margin:0;padding:0}
.container{max-width:900px;margin:40px auto;background:#111;padding:25px;border-radius:20px;box-shadow:0 0 30px rgba(0,0,0,.4)}
h1{color:#00e0b6;margin-bottom:10px}
button{padding:10px 20px;border:none;border-radius:10px;cursor:pointer;color:#fff;font-size:15px;margin:5px}
#login{margin-top:50px}
#login input{padding:10px;font-size:16px;border-radius:8px;border:none}
.approve{background:#00b951}
.reject{background:#ff4d4d}
.addSpeaker{background:#00e0b6}
.logout{background:#666}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:8px;border-bottom:1px solid #333}
audio{width:150px}
.status{font-size:13px;color:#ccc}
input[type=text]{padding:8px;border-radius:8px;border:none;width:200px;margin:5px}
</style>
</head>
<body>
<div id="login">
<h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
<input type="password" id="adminPass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±"><br>
<button onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
<p style="color:#999">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±: 70003mbgz</p>
</div>

<div class="container" id="adminPanel" style="display:none">
<h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</h1>
<button class="addSpeaker" onclick="showAddSpeaker()">â• Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø«</button>
<button class="logout" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
<div id="addSpeakerBox" style="display:none;margin-top:15px">
<input type="text" id="speakerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø« Ø§Ù„Ø¬Ø¯ÙŠØ¯">
<button onclick="addSpeaker()">Ø¥Ø¶Ø§ÙØ©</button>
</div>
<table id="recordsTable">
<thead><tr><th>Ø§Ù„Ù…ØªØ­Ø¯Ø«</th><th>Ø§Ù„Ù†Øµ</th><th>Ø§Ù„ØµÙˆØª</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
<tbody></tbody>
</table>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.47.10/+esm';
const supabase = createClient(
  "https://qcctqvmwwpsoiexgdqwp.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjY3Rxdm13d3Bzb2lleGdkcXdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MjI1OTcsImV4cCI6MjA3ODI5ODU5N30.uTfskCuzkZNcvy1QdaOzqlW8km-wcZQoVRFi6k2xndQ"
);
const BUCKET = "recordings";

const loginDiv=document.getElementById("login");
const panel=document.getElementById("adminPanel");
const tbody=document.querySelector("#recordsTable tbody");

window.checkPass=function(){
  const p=document.getElementById("adminPass").value;
  if(p==="70003mbgz"){loginDiv.style.display="none";panel.style.display="block";loadRecords();}
  else alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
}
window.logout=function(){panel.style.display="none";loginDiv.style.display="block";}

async function loadRecords(){
  tbody.innerHTML="<tr><td colspan=5>â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>";
  const {data,error}=await supabase.from("recordings").select(`id,speaker_id,text_id,status,storage_path,speakers(name),texts(content)`)
    .order("created_at",{ascending:false});
  if(error){tbody.innerHTML="<tr><td colspan=5>âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</td></tr>";return;}
  if(!data.length){tbody.innerHTML="<tr><td colspan=5>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯.</td></tr>";return;}
  tbody.innerHTML="";
  for(const r of data){
    const row=document.createElement("tr");
    row.innerHTML=`<td>${r.speakers?.name||"-"}</td>
    <td>${r.texts?.content?.slice(0,50)||"-"}</td>
    <td><audio controls src="https://qcctqvmwwpsoiexgdqwp.supabase.co/storage/v1/object/public/${BUCKET}/${r.storage_path}"></audio></td>
    <td class='status'>${r.status||"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"}</td>
    <td>
      <button class='approve' onclick='updateStatus(${r.id},"approved")'>âœ…</button>
      <button class='reject' onclick='updateStatus(${r.id},"rejected")'>âŒ</button>
    </td>`;
    tbody.appendChild(row);
  }
}
window.updateStatus=async function(id,status){
  await supabase.from("recordings").update({status}).eq("id",id);
  loadRecords();
}
window.showAddSpeaker=function(){
  const box=document.getElementById("addSpeakerBox");
  box.style.display=box.style.display==="none"?"block":"none";
}
window.addSpeaker=async function(){
  const name=document.getElementById("speakerName").value.trim();
  if(!name){alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø«");return;}
  const {error}=await supabase.from("speakers").insert({name});
  if(error)alert("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
  else{alert("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");document.getElementById("speakerName").value="";}
}
</script>
</body>
</html>