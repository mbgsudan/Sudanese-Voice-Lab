<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª - ØµÙˆØªÙ†Ø§</title>
<style>
body{font-family:Cairo,Arial,sans-serif;background:#0b0b0b;color:#fff;margin:0;text-align:center}
.container{max-width:980px;margin:40px auto;background:#111;padding:24px;border-radius:18px;box-shadow:0 0 35px rgba(0,0,0,.4)}
h1{color:#00e0b6;margin:6px 0 14px}
button{padding:10px 18px;border:none;border-radius:10px;margin:4px;color:#fff;cursor:pointer}
.add{background:#00e0b6} .logout{background:#666} .approve{background:#00b951} .reject{background:#ff4d4d}
table{width:100%;border-collapse:collapse;margin-top:16px;font-size:14px}
th,td{padding:10px;border-bottom:1px solid #2a2a2a;text-align:right}
tr:hover{background:#161616}
audio{width:180px}
#login input{padding:10px;border-radius:8px;border:none}
.small{color:#aaa;font-size:12px}
.form-inline input, .form-inline select{padding:8px;border-radius:8px;border:none;background:#1a1a1a;color:#fff;margin:4px}
</style>
</head>
<body>
<div id="login" class="container">
  <img src="logo-full.png" alt="Ø´Ø¹Ø§Ø± ØµÙˆØªÙ†Ø§" style="width:80px"/>
  <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
  <input type="password" id="adminPass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
  <button onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
  <p class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·.</p>
</div>

<div id="panel" class="container" style="display:none">
  <h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</h1>
  <div>
    <button class="add" onclick="showAddSpeaker()">â• Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø«</button>
    <button class="logout" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
  </div>

  <div id="addBox" class="form-inline" style="display:none;margin-top:10px">
    <input id="spk_name" placeholder="Ø§Ù„Ø§Ø³Ù…" />
    <select id="spk_gender"><option value="">Ø§Ù„Ø¬Ù†Ø³</option><option>Ø°ÙƒØ±</option><option>Ø£Ù†Ø«Ù‰</option></select>
    <select id="spk_age"><option value="">Ø§Ù„Ø¹Ù…Ø±</option><option>20-30</option><option>30-40</option><option>40-50</option></select>
    <select id="spk_accent"><option value="">Ø§Ù„Ù„Ù‡Ø¬Ø©</option><option>Ù„Ù‡Ø¬Ø© Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option><option>ÙˆØ³Ø· Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option><option>Ø´Ø±Ù‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option><option>ØºØ±Ø¨ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option></select>
    <button class="add" onclick="addSpeaker()">Ø­ÙØ¸ Ø§Ù„Ù…ØªØ­Ø¯Ø«</button>
  </div>

  <table>
    <thead><tr><th>Ø§Ù„Ù…ØªØ­Ø¯Ø«</th><th>Ø§Ù„Ù†Øµ</th><th>Ø§Ù„ØµÙˆØª</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script type="module">
import {{ createClient }} from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.47.10/+esm";
const supabase = createClient("https://qcctqvmwwpsoiexgdqwp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjY3Rxdm13d3Bzb2lleGdkcXdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MjI1OTcsImV4cCI6MjA3ODI5ODU5N30.uTfskCuzkZNcvy1QdaOzqlW8km-wcZQoVRFi6k2xndQ");
const BUCKET="recordings";

const loginDiv=document.getElementById("login");
const panel=document.getElementById("panel");
const tbody=document.getElementById("tbody");

window.checkPass=function(){
  const p=document.getElementById("adminPass").value;
  if(p==="70003mbgz"){ loginDiv.style.display="none"; panel.style.display="block"; load(); }
  else alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
};
window.logout=function(){ panel.style.display="none"; loginDiv.style.display="block"; };

async function load(){
  tbody.innerHTML = '<tr><td colspan="5">â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
  const { data, error } = await supabase
    .from("recordings")
    .select(`id,speaker_id,text_id,status,storage_path,speakers(name),texts(content)`)
    .order("created_at",{ascending:false});
  if(error) return tbody.innerHTML='<tr><td colspan="5">âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</td></tr>';
  if(!data?.length) return tbody.innerHTML='<tr><td colspan="5">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯.</td></tr>';
  tbody.innerHTML="";
  data.forEach(r=>{
    const tr=document.createElement("tr");
    const url=`https://qcctqvmwwpsoiexgdqwp.supabase.co/storage/v1/object/public/${BUCKET}/${r.storage_path}`;
    tr.innerHTML = `
      <td>${r.speakers?.name||"-"}</td>
      <td>${(r.texts?.content||"-").slice(0,80)}...</td>
      <td><audio controls src="${url}"></audio></td>
      <td>${r.status||"pending"}</td>
      <td>
        <button class="approve" onclick='updateStatus(${r.id},"approved")'>âœ…</button>
        <button class="reject" onclick='updateStatus(${r.id},"rejected")'>âŒ</button>
      </td>`;
    tbody.appendChild(tr);
  });
}
window.updateStatus = async function(id,status){
  await supabase.from("recordings").update({status}).eq("id",id);
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); load();
};
window.showAddSpeaker=function(){
  const box=document.getElementById("addBox");
  box.style.display = box.style.display==="none"?"block":"none";
};
window.addSpeaker=async function(){
  const name=document.getElementById("spk_name").value.trim();
  const gender=document.getElementById("spk_gender").value;
  const age=document.getElementById("spk_age").value;
  const accent=document.getElementById("spk_accent").value;
  if(!name||!gender||!age||!accent) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");
  const code = "SPK-" + Math.floor(100 + Math.random()*900);
  const { error } = await supabase.from("speakers").insert([{name,gender,age_range:age,accent,code}]);
  if(error) alert("ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©"); else { alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ­Ø¯Ø«"); document.getElementById("addBox").style.display="none"; }
};
</script>
</body>
</html>
