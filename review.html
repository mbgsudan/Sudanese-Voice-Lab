<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª - ØµÙˆØªÙ†Ø§</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
body {
  font-family: "Cairo", sans-serif;
  background: radial-gradient(circle at top, #0d1b1e, #000);
  color: #fff;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 1050px;
  margin: 20px auto;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #00e0b6;
  margin-bottom: 25px;
  text-shadow: 0 0 15px rgba(0, 224, 198, 0.3);
}
.topbar {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}
.btn {
  padding: 10px 18px;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}
.add {
  background: linear-gradient(90deg, #00e0b6, #00b4d8);
  color: #fff;
}
.logout {
  background: #ff4d4d;
  color: #fff;
}
.add:hover { opacity: 0.9; }
.logout:hover { background: #ff6666; }

#addSpeakerBox {
  background: #0f1518;
  border: 1px solid #00e0b6;
  border-radius: 14px;
  padding: 15px;
  margin-bottom: 20px;
  display: none;
  max-width: 550px;
  margin-inline: auto;
}
#addSpeakerBox input, #addSpeakerBox select {
  width: 100%;
  margin: 6px 0;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #333;
  background: #0c0f10;
  color: #fff;
}
.card {
  background: #0f1314;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 18px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  transition: transform .2s ease;
}
.card:hover { transform: translateY(-3px); }
.card-header {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  margin-bottom: 10px;
}
.card-header h3 {
  margin: 0;
  color: #00e0b6;
}
.info {
  font-size: 14px;
  color: #a9b2b3;
  margin-bottom: 8px;
  line-height: 1.8;
}
.audioBox {
  margin: 10px 0;
  background: #1a1f21;
  border-radius: 10px;
  padding: 10px;
}
.status {
  font-size: 14px;
  color: #bbb;
}
.status.pending { color: #ffb347; }
.status.approved { color: #4caf50; }
.status.rejected { color: #ff4d4d; }

.btns {
  margin-top: 10px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.approve {
  background: #00c46b;
  color: #fff;
}
.reject {
  background: #e63946;
  color: #fff;
}
.approve:hover { background: #00e67a; }
.reject:hover { background: #ff5c5c; }
#statusMsg {
  text-align: center;
  margin-top: 10px;
  color: #00e0b6;
}
audio {
  width: 100%;
  border-radius: 8px;
}
</style>
</head>
<body>

<script>
  // ğŸ” Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
  if (!localStorage.getItem("admin_auth")) {
    alert("ğŸ” ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.");
    window.location.href = "admin.html";
  }
</script>

  <div class="container">
    <h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</h1>
    <div class="topbar">
      <button class="btn add" onclick="toggleAddSpeaker()">â• Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø« Ø¬Ø¯ÙŠØ¯</button>
      <button class="btn logout" onclick="logoutAdmin()">ğŸšª Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="addSpeakerBox">
      <h3>Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø« Ø¬Ø¯ÙŠØ¯</h3>
      <input id="spk_name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø«">
      <select id="spk_gender">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
        <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
        <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
      </select>
      <select id="spk_age">
        <option value="">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</option>
        <option value="18-25">18-25</option>
        <option value="25-35">25-35</option>
        <option value="35-45">35-45</option>
      </select>
      <select id="spk_accent">
        <option value="">Ø§Ù„Ù„Ù‡Ø¬Ø©</option>
        <option value="Ø§Ù„Ø®Ø±Ø·ÙˆÙ…">Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option>
        <option value="ÙˆØ³Ø· Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">ÙˆØ³Ø· Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
        <option value="Ø´Ø±Ù‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">Ø´Ø±Ù‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
        <option value="ØºØ±Ø¨ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">ØºØ±Ø¨ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
      </select><br>
      <button class="btn add" onclick="addSpeaker()">ğŸ’¾ Ø­ÙØ¸</button>
      <p id="statusMsg"></p>
    </div>

    <div id="recordsContainer">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª...</div>
  </div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.47.10/+esm";
const supabase = createClient(
  "https://qcctqvmwwpsoiexgdqwp.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjY3Rxdm13d3Bzb2lleGdkcXdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MjI1OTcsImV4cCI6MjA3ODI5ODU5N30.uTfskCuzkZNcvy1QdaOzqlW8km-wcZQoVRFi6k2xndQ"
);

const BUCKET = "recordings";
const container = document.getElementById("recordsContainer");
const statusMsg = document.getElementById("statusMsg");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª
async function loadRecords() {
  container.innerHTML = "â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  const { data, error } = await supabase
    .from("recordings")
    .select(`id, status, storage_path, speakers(name, gender, age_range, accent), texts(content)`)
    .order("created_at", { ascending: false });

  if (error) {
    container.innerHTML = "<p>âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª.</p>";
    return;
  }

  if (!data.length) {
    container.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
    return;
  }

  container.innerHTML = "";
  for (const r of data) {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="card-header">
        <h3>${r.speakers?.name || "Ù…Ø¬Ù‡ÙˆÙ„"}</h3>
        <span class="status ${r.status}">Ø§Ù„Ø­Ø§Ù„Ø©: ${r.status}</span>
      </div>
      <div class="info">
        ğŸ‘¤ Ø§Ù„Ø¬Ù†Ø³: ${r.speakers?.gender || "-"} |
        ğŸ‚ Ø§Ù„Ø¹Ù…Ø±: ${r.speakers?.age_range || "-"} |
        ğŸ—£ï¸ Ø§Ù„Ù„Ù‡Ø¬Ø©: ${r.speakers?.accent || "-"}
      </div>
      <div class="info">ğŸ’¬ Ø§Ù„Ù†Øµ: ${r.texts?.content || "-"}</div>
      <div class="audioBox">
        <audio controls src="https://qcctqvmwwpsoiexgdqwp.supabase.co/storage/v1/object/public/${BUCKET}/${r.storage_path}"></audio>
      </div>
      <div class="btns">
        <button class="btn approve" data-id="${r.id}" data-status="approved">âœ… Ù…ÙˆØ§ÙÙ‚Ø©</button>
        <button class="btn reject" data-id="${r.id}" data-status="rejected">âŒ Ø±ÙØ¶</button>
      </div>
    `;
    container.appendChild(card);
  }

  // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
  document.querySelectorAll(".approve, .reject").forEach(btn => {
    btn.addEventListener("click", async (e) => {
      const id = e.target.dataset.id;
      const status = e.target.dataset.status;
      await updateStatus(id, status);
    });
  });
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
async function updateStatus(id, status) {
  const { error } = await supabase.from("recordings").update({ status }).eq("id", id);
  if (error) alert("âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©");
  else loadRecords();
}

// Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø«
window.addSpeaker = async function () {
  const name = document.getElementById("spk_name").value.trim();
  const gender = document.getElementById("spk_gender").value;
  const age = document.getElementById("spk_age").value;
  const accent = document.getElementById("spk_accent").value;

  if (!name || !gender || !age || !accent) {
    statusMsg.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
    return;
  }

  const { error } = await supabase.from("speakers").insert([{ name, gender, age_range: age, accent }]);
  if (error) statusMsg.textContent = "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
  else {
    statusMsg.textContent = "âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­";
    document.getElementById("addSpeakerBox").style.display = "none";
    loadRecords();
  }
};

// Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
window.toggleAddSpeaker = function () {
  const box = document.getElementById("addSpeakerBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
};

// Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
window.logoutAdmin = function () {
  localStorage.removeItem("admin_auth");
  window.location.href = "index.html";
};

loadRecords();
</script>
</body>
</html>
