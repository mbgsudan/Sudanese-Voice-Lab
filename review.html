<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª - ØµÙˆØªÙ†Ø§</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: "Cairo", sans-serif;
    background: #0b0b0b;
    color: #fff;
    margin: 0;
    padding: 0;
    text-align: center;
  }
  .container {
    max-width: 1000px;
    margin: 40px auto;
    background: #111;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 0 30px rgba(0, 224, 198, 0.2);
  }
  h1 {
    color: #00e0b6;
    margin-bottom: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    padding: 10px;
    border-bottom: 1px solid #333;
    text-align: center;
  }
  th {
    background: #0f1314;
    color: #00e0c6;
  }
  tr:hover {
    background: rgba(0, 224, 198, 0.05);
  }
  button {
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
    transition: 0.2s;
  }
  .approve {
    background: #00b951;
  }
  .reject {
    background: #ff4d4d;
  }
  .approve:hover {
    background: #00d06f;
  }
  .reject:hover {
    background: #ff6666;
  }
  .addSpeaker {
    background: #00e0b6;
    padding: 10px 18px;
    border-radius: 10px;
    margin-bottom: 10px;
    font-weight: 600;
  }
  .logout {
    background: #ff4444;
    padding: 10px 18px;
    border-radius: 10px;
    margin-bottom: 10px;
    font-weight: 600;
  }
  input, select {
    padding: 8px;
    margin: 4px;
    border-radius: 6px;
    border: none;
    width: 90%;
    background: #0f1314;
    color: #fff;
  }
  #addSpeakerBox {
    background: #0f1314;
    border: 1px solid #00e0b6;
    padding: 15px;
    border-radius: 12px;
    margin: 10px auto;
    width: 90%;
  }
  #statusMsg {
    margin-top: 10px;
    color: #00e0b6;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</h1>
    <button class="addSpeaker" onclick="toggleAddSpeaker()">â• Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø« Ø¬Ø¯ÙŠØ¯</button>
    <button class="logout" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>

    <div id="addSpeakerBox" style="display:none;">
      <h3>Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø« Ø¬Ø¯ÙŠØ¯</h3>
      <input id="spk_name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø«">
      <select id="spk_gender">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
        <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
        <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
      </select>
      <select id="spk_age">
        <option value="">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</option>
        <option value="20-30">20-30</option>
        <option value="30-40">30-40</option>
        <option value="40-50">40-50</option>
      </select>
      <select id="spk_accent">
        <option value="">Ø§Ù„Ù„Ù‡Ø¬Ø©</option>
        <option value="Ù„Ù‡Ø¬Ø© Ø§Ù„Ø®Ø±Ø·ÙˆÙ…">Ù„Ù‡Ø¬Ø© Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option>
        <option value="Ù„Ù‡Ø¬Ø© ÙˆØ³Ø· Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">Ù„Ù‡Ø¬Ø© ÙˆØ³Ø· Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
        <option value="Ù„Ù‡Ø¬Ø© Ø´Ø±Ù‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">Ù„Ù‡Ø¬Ø© Ø´Ø±Ù‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
        <option value="Ù„Ù‡Ø¬Ø© ØºØ±Ø¨ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">Ù„Ù‡Ø¬Ø© ØºØ±Ø¨ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
      </select><br>
      <button class="addSpeaker" onclick="addSpeaker()">Ø­ÙØ¸</button>
      <p id="statusMsg"></p>
    </div>

    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ù…ØªØ­Ø¯Ø«</th>
          <th>Ø§Ù„Ø¬Ù†Ø³</th>
          <th>Ø§Ù„Ø¹Ù…Ø±</th>
          <th>Ø§Ù„Ù„Ù‡Ø¬Ø©</th>
          <th>Ø§Ù„Ù†Øµ</th>
          <th>Ø§Ù„ØµÙˆØª</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody id="recordsTable">
        <tr><td colspan="8">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
      </tbody>
    </table>
  </div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.47.10/+esm";
  const supabase = createClient(
    "https://qcctqvmwwpsoiexgdqwp.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjY3Rxdm13d3Bzb2lleGdkcXdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MjI1OTcsImV4cCI6MjA3ODI5ODU5N30.uTfskCuzkZNcvy1QdaOzqlW8km-wcZQoVRFi6k2xndQ"
  );

  const BUCKET = "recordings";
  const tableBody = document.getElementById("recordsTable");
  const statusMsg = document.getElementById("statusMsg");

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª
  async function loadRecords() {
    tableBody.innerHTML = "<tr><td colspan='8'>â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>";
    const { data, error } = await supabase
      .from("recordings")
      .select(`id, status, storage_path, speakers(name, gender, age_range, accent), texts(content)`)
      .order("created_at", { ascending: false });

    if (error) {
      tableBody.innerHTML = "<tr><td colspan='8'>âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</td></tr>";
      return;
    }
    if (!data.length) {
      tableBody.innerHTML = "<tr><td colspan='8'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯.</td></tr>";
      return;
    }

    tableBody.innerHTML = "";
    for (const r of data) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${r.speakers?.name || "-"}</td>
        <td>${r.speakers?.gender || "-"}</td>
        <td>${r.speakers?.age_range || "-"}</td>
        <td>${r.speakers?.accent || "-"}</td>
        <td>${r.texts?.content || "-"}</td>
        <td><audio controls src="https://qcctqvmwwpsoiexgdqwp.supabase.co/storage/v1/object/public/${BUCKET}/${r.storage_path}"></audio></td>
        <td>${r.status}</td>
        <td>
          <button class="approve" onclick="updateStatus(${r.id}, 'approved')">âœ… Ù…ÙˆØ§ÙÙ‚Ø©</button>
          <button class="reject" onclick="updateStatus(${r.id}, 'rejected')">âŒ Ø±ÙØ¶</button>
        </td>
      `;
      tableBody.appendChild(row);
    }
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
  window.updateStatus = async function (id, status) {
    const { error } = await supabase.from("recordings").update({ status }).eq("id", id);
    if (error) alert("âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©");
    else loadRecords();
  };

  // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ­Ø¯Ø«
  window.toggleAddSpeaker = function () {
    const box = document.getElementById("addSpeakerBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
  };

  // Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­Ø¯Ø« Ø¬Ø¯ÙŠØ¯
  window.addSpeaker = async function () {
    const name = document.getElementById("spk_name").value.trim();
    const gender = document.getElementById("spk_gender").value;
    const age = document.getElementById("spk_age").value;
    const accent = document.getElementById("spk_accent").value;

    if (!name || !gender || !age || !accent) {
      statusMsg.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„";
      return;
    }

    const { error } = await supabase.from("speakers").insert([{ name, gender, age_range: age, accent }]);
    if (error) statusMsg.textContent = "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
    else {
      statusMsg.textContent = "âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­";
      document.getElementById("addSpeakerBox").style.display = "none";
      loadRecords();
    }
  };

  window.logout = function () {
    location.href = "/";
  };

  loadRecords();
</script>
</body>
</html>
