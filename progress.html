
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ØµÙˆØªÙ†Ø§ â€“ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="container">
    <header>
      <img src="logo-full.png" class="logo" alt="ØµÙˆØªÙ†Ø§"/>
      <h2>ğŸ“ˆ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h2>
      <p class="sub">Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„ØªÙ‚Ø¯Ù….</p>
    </header>

    <div class="panel kpis">
      <div class="card"><div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</div><div id="k-total" class="num">â€”</div></div>
      <div class="card"><div>Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</div><div id="k-approved" class="num">â€”</div></div>
      <div class="card"><div>Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</div><div id="k-rejected" class="num">â€”</div></div>
    </div>

    <div class="panel">
      <div id="bySpeaker" class="list"></div>
      <p class="small">ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ØªØ­Ø¯Ø«ÙŠÙ† Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª.</p>
    </div>

    <div class="footer">Ù…Ù†ØµØ© ØµÙˆØªÙ†Ø§ 2025</div>
  </div>

  <script type="module">
    if (!sessionStorage.getItem('sawtna_admin_ok')){
      const pw = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø´Ø±Ù:');
      if(pw !== '70003mbgz'){ location.href = 'admin.html'; }
      else { sessionStorage.setItem('sawtna_admin_ok', '1'); }
    }

    import { supabase } from './config.js';
    const totalEl=document.getElementById('k-total'), appEl=document.getElementById('k-approved'), rejEl=document.getElementById('k-rejected');
    async function loadKPIs(){
      const all=await supabase.from('recordings').select('id',{count:'exact', head:true});
      const app=await supabase.from('recordings').select('id',{count:'exact', head:true}).eq('qa_status','approved');
      const rej=await supabase.from('recordings').select('id',{count:'exact', head:true}).eq('qa_status','rejected');
      totalEl.textContent=all.count??0; appEl.textContent=app.count??0; rejEl.textContent=rej.count??0;
    }
    async function loadBySpeaker(){
      const sp=await supabase.from('speakers').select('id,code,name').order('code');
      const container=document.getElementById('bySpeaker'); container.innerHTML='';
      for(const s of (sp.data||[])){
        const cnt=await supabase.from('recordings').select('id',{count:'exact', head:true}).eq('speaker_id', s.id);
        const item=document.createElement('div'); item.className='card';
        item.innerHTML = `<div class="badge">${s.code} â€” ${s.name||''}</div><div class="num">${cnt.count||0}</div>`;
        container.appendChild(item);
      }
    }
    await loadKPIs();
    await loadBySpeaker();
  </script>
</body>
</html>
